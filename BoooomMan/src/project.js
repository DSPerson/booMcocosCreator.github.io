require=function a(n,c,s){function l(i,e){if(!c[i]){if(!n[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(p)return p(i,!0);var o=new Error("Cannot find module '"+i+"'");throw o.code="MODULE_NOT_FOUND",o}var r=c[i]={exports:{}};n[i][0].call(r.exports,function(e){var t=n[i][1][e];return l(t||e)},r,r.exports,a,n,c,s)}return c[i].exports}for(var p="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({DSTiledMap:[function(e,t,i){"use strict";cc._RF.push(t,"259d6wcN1VEmZDLIGDW7lV5","DSTiledMap"),Object.defineProperty(i,"__esModule",{value:!0});i.default=function(){var e={getTilePos:function(e,t,i){}};return e},t.exports=i.default,cc._RF.pop()},{}],bomb:[function(e,t,i){"use strict";cc._RF.push(t,"258d7kkBIhL4r0zymuXPf4B","bomb"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},exploded:function(){this.node.parent.emit("kBombExploded")},start:function(){}}),cc._RF.pop()},{}],buttonControl:[function(e,t,i){"use strict";cc._RF.push(t,"314feVqL2NBAZxKSf/rFytM","buttonControl");cc.Class({extends:cc.Component,properties:{left:{default:null,type:cc.Sprite},leftSpriteFrame:cc.SpriteFrame,leftSpriteFrameNomal:cc.SpriteFrame,right:{default:null,type:cc.Sprite},rightSpriteFrame:cc.SpriteFrame,rightSpriteFrameNomal:cc.SpriteFrame,up:{default:null,type:cc.Sprite},upSpriteFrame:cc.SpriteFrame,upSpriteFrameNomal:cc.SpriteFrame,down:{default:null,type:cc.Sprite},downSpriteFrame:cc.SpriteFrame,downSpriteFrameNomal:cc.SpriteFrame,bomb:{default:null,type:cc.Sprite},bombSpriteFrame:cc.SpriteFrame,bombSpriteFrameNomal:cc.SpriteFrame},changeButtonTransition:function(e){var t=this;switch(cc.log("who == ",e),e){case"up":this.up.spriteFrame=this.upSpriteFrame,this.scheduleOnce(function(){t.up.spriteFrame=t.upSpriteFrameNomal},.3);break;case"down":this.down.spriteFrame=this.downSpriteFrame,this.scheduleOnce(function(){t.down.spriteFrame=t.downSpriteFrameNomal},.3);break;case"right":this.right.spriteFrame=this.rightSpriteFrame,this.scheduleOnce(function(){t.right.spriteFrame=t.rightSpriteFrameNomal},.3);break;case"left":this.left.spriteFrame=this.leftSpriteFrame,this.scheduleOnce(function(){t.left.spriteFrame=t.leftSpriteFrameNomal},.3);break;case"btnBomb":this.bomb.spriteFrame=this.bombSpriteFrame,this.scheduleOnce(function(){t.bomb.spriteFrame=t.bombSpriteFrameNomal},.3)}},start:function(){}}),cc._RF.pop()},{}],enemy:[function(e,t,i){"use strict";cc._RF.push(t,"8cfdfeLV71GbqCLrvjtY1Kv","enemy");var o,r=e("./DSTiledMap");(o=r)&&o.__esModule;var a=cc.Enum({alive:0,deadIng:1,deaded:2}),h=cc.Enum({up:0,right:1,down:2,left:3,unkown:4});cc.Enum({nomal:0,trudge:1});cc.Class({extends:cc.Component,properties:{enemyNode:{default:null,type:cc.Node},enemyViewLength:{default:150,type:cc.Integer},enemySpeed:{default:0,type:cc.Float}},onLoad:function(){this.enemyState=a.alive,this.enemyNode.getComponent(cc.Animation).play("enemy_move"),this.direction=h.right},initWithParas:function(e,t,i,o){this.player=e,this.map=t,this.mainLayer=i,this.soilLayer=o},goDead:function(e){this.enemyState==a.alive&&(this.enemyState=a.deadIng,this.enemyNode.getComponent(cc.Animation).play("enemy_dead"),this.callBack=e)},canKillPlayer:function(){return this.enemyState==a.alive},deadCallBack:function(){this.enemyState=a.deaded,this.callBack&&this.callBack(),this.node.removeFromParent()},start:function(){},update:function(e){if(this.player.getComponent("player").playerLive()){var t=this.node.parent,i=this.node.position.x,o=this.player.position.x,r=this.node.position.y,a=this.player.position.y,n=Math.abs(i-o),c=Math.abs(r-a),s=(Math.sqrt(Math.pow(n,2)+Math.pow(c,2)),t.getContentSize().width),l=t.getContentSize().height;if(this.direction==h.right?s<i+64?(this.direction=h.left,this.node.setPosition(cc.p(i-this.enemySpeed,r))):this.node.setPosition(cc.p(i+this.enemySpeed,r)):this.direction==h.left?i<32?(this.direction=h.right,this.node.setPosition(cc.p(i+this.enemySpeed,r))):this.node.setPosition(cc.p(i-this.enemySpeed,r)):this.direction==h.down||(this.direction,h.up),cc.log(this.player.position.x),cc.log(this.enemyNode.position.x),cc.pointEqualToPoint(this.player.position,cc.p(this.enemyNode.position.x,l-this.enemyNode.position.y))){var p=this;this.player.getComponent("player").playPlayerAnimation("dead",function(){p.map.node.emit("gameOver")})}}},getTilePos:function(e){var t=this.map.getTileSize(),i=Math.floor(e.x/t.width),o=Math.floor(e.y/t.height);return cc.p(i,o)}}),cc._RF.pop()},{"./DSTiledMap":"DSTiledMap"}],game:[function(e,t,i){"use strict";cc._RF.push(t,"a51e4MazEdO9qcnkzvNXnIK","game");var n=cc.Enum({up:0,right:1,down:2,left:3,unkown:4});cc.Class({extends:cc.Component,properties:{map:{default:null,type:cc.TiledMap},soilLayer:{default:null,type:cc.TiledLayer},hideLayer:{default:null,type:cc.TiledLayer},mainLayer:{default:null,type:cc.TiledLayer},bombPrefab:{default:null,type:cc.Prefab},bombArray:{default:[],type:[cc.Node],visible:!1},bombPosotionArray:{default:[],type:[cc.Vec2],visible:!1},maxBombCount:{default:1,type:cc.Integer,visible:!1},player:{default:null,type:cc.Node},enemy:{default:null,type:cc.Node},btnGroup:{default:null,type:cc.Node},popsArray:{default:[],type:[cc.Vec2]},playerSpeed:{default:1,type:cc.Integer,visible:!1}},onLoad:function(){this.loadMap(),this.addOn(),this.nodeAddEmitWithTouch()},loadPopsPosition:function(){var o=this;cc.loader.loadRes("config/scene_config_0",function(e,t){if(e)cc.log("loadPopsPosition error == "+e);else{var i=t.scene_config_0;o.popsArray=i}})},nodeAddEmitWithTouch:function(){var o=this;cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(e){var t=o.btnGroup.getComponent("buttonControl"),i="";switch(e.keyCode){case cc.KEY.a:case cc.KEY.left:cc.log("左"),i="left";break;case cc.KEY.w:case cc.KEY.up:cc.log("上"),i="up";break;case cc.KEY.d:case cc.KEY.right:i="right",cc.log("右");break;case cc.KEY.s:case cc.KEY.down:cc.log("down"),i="down";break;case cc.KEY.space:i="btnBomb"}o.btnControl(null,i),t.changeButtonTransition(i),o.player.getComponent("player").playPlayerAnimation(i)},this)},addOn:function(){var l=this;this.map.node.on("kBombExploded",function(e){if(0!==l.bombArray.length){var t=l.bombArray[0],i=l.bombPosotionArray[0],o=cc.p(i.x-1,i.y),r=cc.p(i.x+1,i.y),a=cc.p(i.x,i.y-1),n=cc.p(i.x,i.y+1),c=cc.p(i.x,i.y);if(l.bombExploadToOtherDead(o,l.playerTile)||l.bombExploadToOtherDead(r,l.playerTile)||l.bombExploadToOtherDead(a,l.playerTile)||l.bombExploadToOtherDead(n,l.playerTile)||l.bombExploadToOtherDead(c,l.playerTile)){var s=l;return void l.player.getComponent("player").playPlayerAnimation("dead",function(){s.gameOver()})}if(l.bombExploadToOtherDead(o,l.enemyTile)||l.bombExploadToOtherDead(r,l.enemyTile)||l.bombExploadToOtherDead(a,l.enemyTile)||l.bombExploadToOtherDead(n,l.enemyTile)||l.bombExploadToOtherDead(c,l.enemyTile)){cc.log("炸死怪物");s=l;l.enemy.getComponent("enemy").goDead(function(){cc.log("删除怪物"),s.mainLayer.removeTileAt(s.enemyTile)})}l.soilLayer.getTileGIDAt(o)&&l.soilLayer.removeTileAt(o),l.soilLayer.getTileGIDAt(r)&&l.soilLayer.removeTileAt(r),l.soilLayer.getTileGIDAt(a)&&l.soilLayer.removeTileAt(a),l.soilLayer.getTileGIDAt(n)&&l.soilLayer.removeTileAt(n),l.map.node.removeChild(t),l.bombArray.shift(),l.bombPosotionArray.shift()}}),this.map.node.on("gameOver",function(){l.gameOver()})},bombExploadToOtherDead:function(e,t){return e.x==t.x&&e.y==t.y},btnControl:function(e,t){switch(t){case"left":this.playerDir=n.left,this.tryMoveToTarTile(cc.p(this.playerTile.x-this.playerSpeed,this.playerTile.y));break;case"right":this.playerDir=n.right,this.tryMoveToTarTile(cc.p(this.playerTile.x+this.playerSpeed,this.playerTile.y));break;case"down":this.playerDir=n.down,this.tryMoveToTarTile(cc.p(this.playerTile.x,this.playerTile.y+this.playerSpeed));break;case"up":this.playerDir=n.up,this.tryMoveToTarTile(cc.p(this.playerTile.x,this.playerTile.y-this.playerSpeed));break;case"btnBomb":this.addBomb()}},playerWithBomb:function(){for(var e=0;e<this.bombPosotionArray.length;e++)if(this.playerTile.x==this.bombPosotionArray[e].x&&this.playerTile.y==this.bombPosotionArray[e].y)return!0;return!1},playerDircectionHadBomb:function(){for(var e=0;e<this.bombPosotionArray.length;e++){if(this.playerTile.x-1==this.bombPosotionArray[e].x&&this.playerTile.y==this.bombPosotionArray[e].y&&this.playerDir==n.left)return!0;if(this.playerTile.x+1==this.bombPosotionArray[e].x&&this.playerTile.y==this.bombPosotionArray[e].y&&this.playerDir==n.right)return!0;if(this.playerTile.x==this.bombPosotionArray[e].x&&this.playerTile.y-1==this.bombPosotionArray[e].y&&this.playerDir==n.up)return!0;if(this.playerTile.x==this.bombPosotionArray[e].x&&this.playerTile.y+1==this.bombPosotionArray[e].y&&this.playerDir==n.down)return!0}return!1},addBomb:function(){if(!(this.bombArray.length>=this.maxBombCount||this.playerWithBomb())){var e=cc.instantiate(this.bombPrefab);e.setAnchorPoint(0,0),this.map.node.addChild(e);var t=this.playerTile;this.bombPosotionArray.push(t);var i=this.mainLayer.getPositionAt(t);e.setPosition(i),this.bombArray.push(e)}},start:function(){},getTilePos:function(e){var t=this.map.getTileSize(),i=Math.floor(e.x/t.width),o=Math.floor(e.y/t.height);return cc.p(i,o)},loadMap:function(){var e=this.map.getObjectGroup("objects"),t=e.getObject("player"),i=e.getObject("enemy"),o=cc.p(t.offset.x,t.offset.y),r=cc.p(i.offset.x,i.offset.y);this.playerTile=this.getTilePos(o),this.enemyTile=this.getTilePos(r);var a=this.mainLayer.getPositionAt(this.enemyTile);this.enemy.setPosition(a),this.enemy.getComponent("enemy").initWithParas(this.player,this.map,this.mainLayer,this.soilLayer),this.enemyDir=n.right,this.updatePlayerPos(),this.playerDir=n.unkown},updatePlayerPos:function(){var e=this.mainLayer.getPositionAt(this.playerTile);this.player.setPosition(e)},tryMoveToTarTile:function(e){if(this.player.getComponent("player").playerLive()){if(0!=this.mainLayer.getTileGIDAt(e))return cc.log("player hit the hall"),!1;if(0!=this.soilLayer.getTileGIDAt(e))return cc.log("player hit the soil"),!1;if(!this.playerDircectionHadBomb()){if(cc.pointEqualToPoint(e,this.enemyTile)&&this.enemy.getComponent("enemy").canKillPlayer()){var t=this;return cc.log("碰到怪物"),this.player.getComponent("player").playPlayerAnimation("dead",function(){t.gameOver()}),!1}this.hitTheProp(e),this.playerTile=e,this.updatePlayerPos()}}},hitTheProp:function(e){if(this.hideLayer.getTileGIDAt(e)){var t=this.hideLayer.getTileGIDAt(e),i=this.map.getPropertiesForGID(t);switch(this.hideLayer.removeTileAt(e),cc.log("daoju == ",i.type),i.type){case"0":break;case"1":this.maxBombCount++;break;case"2":this.playerSpeed+=0;break;case"3":break;case"100":this.gameOver()}}},gameOver:function(){cc.director.loadScene("game")},updateEnemyPos:function(){},update:function(e){this.updateEnemyPos()}}),cc._RF.pop()},{}],player:[function(e,t,i){"use strict";cc._RF.push(t,"7cfaai9qsNLkYoZMi/TlGSw","player");var r=cc.Enum({alive:0,deadIng:1,deaded:2});cc.Class({extends:cc.Component,properties:{player:{default:null,type:cc.Sprite}},onLoad:function(){this.kEnemyState=r.alive},playerLive:function(){return this.kEnemyState==r.alive},playPlayerAnimation:function(e,t){if(this.kEnemyState==r.alive)switch(e){case"up":this.player.getComponent(cc.Animation).play("player_move_up");break;case"down":this.player.getComponent(cc.Animation).play("player_move_down");break;case"right":this.player.getComponent(cc.Animation).play("player_move_right");break;case"left":this.player.getComponent(cc.Animation).play("player_move_left");break;case"dead":this.kEnemyState=r.deadIng;var i=this.node.getComponent(cc.Animation).playAdditive("player_dead");if(this.kEnemyState=r.deaded,null!==t){var o=i.duration;this.scheduleOnce(function(){t()},o+.7)}}},start:function(){}}),cc._RF.pop()},{}],predefines:[function(e,t,i){"use strict";cc._RF.push(t,"62c5ebFCbNPGqmbljDhiEli","predefines"),t.exports={},cc._RF.pop()},{}]},{},["DSTiledMap","bomb","buttonControl","enemy","game","player","predefines"]);